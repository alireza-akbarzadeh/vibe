enum MediaStatus {
    DRAFT
    REVIEW
    PUBLISHED
    REJECTED
}

model Media {
    id          String    @id @default(cuid())
    title       String
    description String
    thumbnail   String
    videoUrl    String?
    audioUrl    String?
    duration    Int
    releaseYear Int
    type        MediaType
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt

    collectionId String?
    collection   Collection? @relation(fields: [collectionId], references: [id], onDelete: SetNull)

    sortOrder     Int?
    status        MediaStatus      @default(DRAFT)
    rating        Float?           @default(0)
    reviewCount   Int              @default(0)
    criticalScore Float?           @default(0)
    viewCount     Int              @default(0)
    genres        MediaGenre[]
    creators      MediaCreator[]
    history       ViewingHistory[]
    favorites     Favorite[]
    watchList     WatchList[]
    reviews       UserReview[]
    videos        Video[]
    images        Image[]
    cast          MediaCast[]

    @@index([title])
    @@index([title, status])
    @@index([title, releaseYear])
    @@index([createdAt])
    @@map("Media")
}

model Person {
    id                 String   @id @default(cuid())
    tmdbId             Int      @unique @map("tmdb_id")
    adult              Boolean  @default(false)
    gender             Int?     @default(0)
    knownForDepartment String?  @map("known_for_department") @db.VarChar(100)
    name               String   @db.VarChar(255)
    originalName       String   @map("original_name") @db.VarChar(255)
    popularity         Float    @default(0.0)
    profilePath        String?  @map("profile_path") @db.VarChar(500)
    createdAt          DateTime @default(now()) @map("created_at")
    updatedAt          DateTime @updatedAt @map("updated_at")

    knownFor  KnownFor[]
    mediaCast MediaCast[]

    @@index([name])
    @@index([popularity(sort: Desc)])
    @@index([knownForDepartment])
    @@index([tmdbId])
    @@map("person")
}

enum CastType {
    ACTOR
    DIRECTOR
    WRITER
    PRODUCER
    CINEMATOGRAPHER
    COMPOSER
    EDITOR
    OTHER
}

model MediaCast {
    id           String   @id @default(cuid())
    mediaId      String   @map("media_id")
    personId     String   @map("person_id")
    castType     CastType @map("cast_type")
    role         String?  @db.VarChar(500) // Character name for actors, job title for crew
    order        Int      @default(0) // Display order (for actors especially)
    tmdbCreditId String?  @unique @map("tmdb_credit_id") @db.VarChar(100)
    createdAt    DateTime @default(now()) @map("created_at")
    updatedAt    DateTime @updatedAt @map("updated_at")

    media  Media  @relation(fields: [mediaId], references: [id], onDelete: Cascade)
    person Person @relation(fields: [personId], references: [id], onDelete: Cascade)

    @@unique([mediaId, personId, castType, role])
    @@index([mediaId])
    @@index([personId])
    @@index([castType])
    @@index([order])
    @@map("media_cast")
}

model KnownFor {
    id               String    @id @default(cuid())
    personId         String    @map("person_id")
    tmdbId           Int       @map("tmdb_id")
    adult            Boolean   @default(false)
    backdropPath     String?   @map("backdrop_path") @db.VarChar(500)
    title            String    @db.VarChar(255)
    originalLanguage String?   @map("original_language") @db.VarChar(10)
    originalTitle    String?   @map("original_title") @db.VarChar(255)
    overview         String?   @db.Text
    posterPath       String?   @map("poster_path") @db.VarChar(500)
    mediaType        String    @map("media_type") @db.VarChar(50)
    genreIds         String    @map("genre_ids") @db.Text
    popularity       Float     @default(0.0)
    releaseDate      DateTime? @map("release_date")
    video            Boolean   @default(false)
    voteAverage      Float     @default(0.0) @map("vote_average")
    voteCount        Int       @default(0) @map("vote_count")
    createdAt        DateTime  @default(now()) @map("created_at")
    updatedAt        DateTime  @updatedAt @map("updated_at")

    person Person @relation(fields: [personId], references: [id], onDelete: Cascade)

    @@unique([personId, tmdbId])
    @@index([personId])
    @@index([tmdbId])
    @@index([mediaType])
    @@index([popularity(sort: Desc)])
    @@index([releaseDate(sort: Desc)])
    @@map("known_for")
}

model Video {
    id          String    @id @default(cuid())
    mediaId     String    @map("media_id")
    tmdbId      String    @map("tmdb_id")
    iso6391     String?   @map("iso_639_1") @db.VarChar(10)
    iso31661    String?   @map("iso_3166_1") @db.VarChar(10)
    name        String    @db.VarChar(500)
    key         String    @db.VarChar(255)
    site        String    @db.VarChar(50)
    size        Int       @default(1080)
    type        VideoType
    official    Boolean   @default(false)
    publishedAt DateTime  @map("published_at")
    createdAt   DateTime  @default(now()) @map("created_at")
    updatedAt   DateTime  @updatedAt @map("updated_at")

    media Media @relation(fields: [mediaId], references: [id], onDelete: Cascade)

    @@unique([mediaId, tmdbId])
    @@index([type])
    @@index([mediaId])
    @@index([official])
    @@index([publishedAt(sort: Desc)])
    @@map("video")
}

enum VideoType {
    Trailer
    Teaser
    Clip
    Featurette
    BehindTheScenes @map("Behind the Scenes")
    Bloopers
    Recap
    Opening
}

model Image {
    id          String    @id @default(cuid())
    mediaId     String    @map("media_id")
    filePath    String    @map("file_path") @db.VarChar(500)
    aspectRatio Float     @map("aspect_ratio")
    height      Int
    width       Int
    iso6391     String?   @map("iso_639_1") @db.VarChar(10)
    voteAverage Float     @default(0) @map("vote_average")
    voteCount   Int       @default(0) @map("vote_count")
    type        ImageType
    createdAt   DateTime  @default(now()) @map("created_at")
    updatedAt   DateTime  @updatedAt @map("updated_at")

    media Media @relation(fields: [mediaId], references: [id], onDelete: Cascade)

    @@unique([mediaId, filePath])
    @@index([mediaId])
    @@index([type])
    @@index([voteAverage(sort: Desc)])
    @@map("image")
}

enum ImageType {
    Backdrop
    Poster
    Still
    Logo
}

model Collection {
    id          String         @id @default(cuid())
    title       String
    description String?
    thumbnail   String?
    type        CollectionType
    createdAt   DateTime       @default(now())
    updatedAt   DateTime       @updatedAt

    media Media[]
}

enum GenreType {
    MOVIE
    EPISODE
    TRACK
}

model Genre {
    id          String    @id @default(cuid())
    name        String    @unique
    description String?
    type        GenreType @default(MOVIE)

    media MediaGenre[]
}

model MediaGenre {
    mediaId String
    genreId String

    media Media @relation(fields: [mediaId], references: [id], onDelete: Cascade)
    genre Genre @relation(fields: [genreId], references: [id], onDelete: Cascade)

    @@id([mediaId, genreId])
}

model Creator {
    id        String    @id @default(cuid())
    name      String
    bio       String?
    image     String?
    birthDate DateTime?

    media MediaCreator[]
}

model MediaCreator {
    mediaId   String
    creatorId String
    role      CreatorRole

    media   Media   @relation(fields: [mediaId], references: [id], onDelete: Cascade)
    creator Creator @relation(fields: [creatorId], references: [id], onDelete: Cascade)

    @@id([mediaId, creatorId, role])
}

model ViewingHistory {
    id            String   @id @default(cuid())
    profileId     String
    mediaId       String
    progress      Int
    completed     Boolean  @default(false)
    viewedAt      DateTime @default(now())
    lastWatchedAt DateTime @updatedAt

    profile Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
    media   Media   @relation(fields: [mediaId], references: [id], onDelete: Cascade)

    @@unique([profileId, mediaId])
    @@index([profileId, mediaId])
    @@index([profileId, lastWatchedAt])
}

model Favorite {
    id        String   @id @default(cuid())
    userId    String
    mediaId   String
    createdAt DateTime @default(now())

    user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
    media Media @relation(fields: [mediaId], references: [id], onDelete: Cascade)

    @@unique([userId, mediaId])
}

model WatchList {
    id        String   @id @default(cuid())
    userId    String
    mediaId   String
    createdAt DateTime @default(now())

    user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
    media Media @relation(fields: [mediaId], references: [id], onDelete: Cascade)

    @@unique([userId, mediaId])
}

enum CollectionType {
    SERIES
    ALBUM
    PLAYLIST
}

enum MediaType {
    MOVIE
    EPISODE
    TRACK
}

enum CreatorRole {
    DIRECTOR
    ARTIST
    ACTOR
    PRODUCER
}

model UserReview {
    id        String   @id @default(cuid())
    userId    String
    mediaId   String
    rating    Float
    review    String?  @db.Text
    helpful   Int      @default(0)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
    media Media @relation(fields: [mediaId], references: [id], onDelete: Cascade)

    @@unique([userId, mediaId])
    @@index([mediaId])
    @@index([userId])
}
